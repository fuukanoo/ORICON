
---

# 要件定義書：異業種シナジー発見AI（CISF）

---

## 1. プロジェクト概要

| 項目          | 内容                                                                                      |
| ----------- | --------------------------------------------------------------------------------------- |
| **プロジェクト名** | 異業種コラボ発掘AI：Cross‑Industry Synergy Finder（CISF）                                          |
| **目的**      | 満足度アンケートデータから「エントロピーが下がり」「平均スコアが上がる」組み合わせを発見し、ブランド間コラボの新提案を自動生成する。                      |
| **PoC成功条件** | ・コラボ候補5件以上を提示し、いずれも Δμ>0 かつ ΔH>0<br>・過去のコラボを用いた Precision\@5 が 0.3 以上                   |
| **対象データ**   | ・動画配信サービス（30ブランド × 約3,000人）<br>・納税サイト、結婚相談、ジム等（別回答者群）<br>・Likertスケール（1–5, 1–10混在）、属性データ |
| **除外範囲**    | 実サービス実装、需要予測、課金連動広告などは対象外                                                               |
| **開発期間**    | 全6週間：W1–2 データ & アンカー → W3 HB → W4 VGAE → W5 UI → W6 検証・成果物化                             |
| **関係者**     | ・ビジコン審査員<br>・マーケ／カスタマー部門<br>・法務・DP責任者<br>・データサイエンスチーム                                   |

---

## 2. 用語定義（抜粋）

| 用語             | 定義                                  |
| -------------- | ----------------------------------- |
| **アンカー**       | 業種横断で満足度の“意味軸”となる概念（例：使いやすさ、価格納得感）  |
| **Δμ**         | コラボ後に平均満足度がどれだけ上がるか（i←j方向）          |
| **ΔH**         | コラボ後に満足度のばらつき（エントロピー）がどれだけ下がるか      |
| **ValueUpエッジ** | Δμ>0かつΔH>0が過半数のアンカーで成立しているペア        |
| **HB**         | Likert応答をベースにした階層ベイズの順序ロジットモデル      |
| **VGAE**       | グラフオートエンコーダ（ノードの潜在表現を学習し、未観測リンクを予測） |

---

## 3. 機能要件（抜粋）

### 3.1 データ処理

| 要件ID  | 内容                                                                                       |
| ----- | ---------------------------------------------------------------------------------------- |
| FR-01 | 複数業種のExcel/CSVを読み込み、long形式に統合：`respondent_id, brand_id, industry_id, question_id, score` |
| FR-02 | Likertの尺度差（1–5, 1–10）を自動で0–1に変換                                                          |
| FR-03 | クレンジング後はParquet形式で保存 + 検査ログを生成                                                           |

### 3.2 質問のアンカー整合

| FR-ID | 内容                                         |
| ----- | ------------------------------------------ |
| FR-10 | `anchors.yaml` に6軸以上のアンカー語を記述（編集可能）        |
| FR-11 | 質問文をSBERTでベクトル化→各アンカーとのコサイン類似度計算           |
| FR-12 | Softmax正規化（温度 τ=0.05）し質問×アンカーの重み行列を作成      |
| FR-13 | 各アンカーのtopic-coherenceが0.4未満なら処理を中止しアラートを出す |

### 3.3 顧客構成比（w）の扱い

| FR-ID | 内容                                        |
| ----- | ----------------------------------------- |
| FR-20 | 業種別の市場シェアデータがある場合は、それに基づいてwを設定            |
| FR-21 | シェア不明な業種は、w \~ Beta(1,1)として階層ベイズで事後推定     |
| FR-22 | Streamlit上のスライダーでwを調整可能にし、2秒以内に再計算を完了すること |

### 3.4 モデル分岐（HB / VGAE）

| モデル      | 必須処理                                                                                      |
| -------- | ----------------------------------------------------------------------------------------- |
| **HB**   | ・ブランドα、業種δで順序ロジットモデル<br>・非線形項γ α\_i α\_j を学習に含める<br>・サンプルは1,000回取得                        |
| **VGAE** | ・属性ベースのエッジ（類似性 / 補完）を生成<br>・GCN Encoder → 8次元潜在空間学習<br>・MixNetで非線形合成（自己教師 or few-shot微調整） |

### 3.5 指標計算

| FR-ID | 内容                                                       |
| ----- | -------------------------------------------------------- |
| FR-30 | 各ブランド×アンカーごとにμ、H、95%信頼区間を計算                              |
| FR-31 | 全ブランドペアに対してΔμ\_i←j, ΔH\_i←j, JS距離を算出                     |
| FR-32 | Amplify（JS類似）、Complement（補完）、ValueUp（平均↑かつばらつき↓）の隣接行列を出力 |
| FR-33 | エッジに重み：Δμ=線幅、ΔH=色として保持                                   |

### 3.6 可視化UI（Streamlit）

| FR-ID | 内容                                     |
| ----- | -------------------------------------- |
| FR-40 | タブ切替（補完 / 増幅 / ValueUp）付きのUIを実装        |
| FR-41 | wスライダー、Δμ・ΔHのしきい値スライダー、Top-k調整など       |
| FR-42 | グラフ画面：ノードサイズ=平均μ、線幅=Δμ、色=ΔH            |
| FR-43 | ノードクリックでブランドのレーダーチャートとSHAP棒グラフを表示（説明性） |

### 3.7 評価・成果物

| FR-ID | 内容                                      |
| ----- | --------------------------------------- |
| FR-50 | 過去の既知コラボ10件でPrecision\@5、AUC等を算出        |
| FR-51 | wと非線形項γの感度分析マトリクスを生成                    |
| FR-52 | ピッチ資料（スライド）を自動生成：要点、結果、KPI試算、リスク項目を含むこと |

---

## 4. 非機能要件

| 区分         | 要件                                      |
| ---------- | --------------------------------------- |
| **処理速度**   | HB学習：5分以内、VGAE学習：5分以内（CPUでOK）、UI応答：2秒以内 |
| **拡張性**    | 最大100ブランド × 1万回答まで無変更で処理可能              |
| **説明可能性**  | 推奨理由はすべてアンカーごとのΔμ/ΔH + SHAP値で提示         |
| **法令遵守**   | k-匿名性 ≥ 5、Demographic Parity Gap ≤ 0.1  |
| **セキュリティ** | 全処理はローカル環境内で実行、個人情報は外部送信不可              |
| **移植性**    | Docker化 / `start.sh` で一括起動可能にすること       |

---

## 5. 実装アーキテクチャ（概要）

1. **データ処理層**（pandas + pyarrow）
2. **モデリング層**：HB（PyMC）または VGAE（PyTorch Geometric）をCLI引数で選択
3. **指標計算層**：NumPyベース、隣接行列は `.npz` で出力
4. **UI層**：Streamlit、SHAP連携あり
5. **成果物層**：`graph.html`, `auto_pitch.pptx`, `eval_report.md` を自動生成

---

## 6. 担当分担（例）

| 担当       | 役割                           |
| -------- | ---------------------------- |
| データエンジニア | フェーズ0～1、Docker整備             |
| サイエンティスト | モデル・指標計算・検証ロジック全般            |
| フロントエンド  | Streamlit + SHAP UIの構築       |
| プロダクト責任者 | アンカー承認、PoC成否判定、成果報告スライドのレビュー |
| 法務・DP    | k-匿名性とDP Gapのチェック・許諾         |

---

## 7. リスク管理（上位3件）

| リスク             | 影響          | 対策                            |
| --------------- | ----------- | ----------------------------- |
| アンカーが業種によって無意味化 | 推奨が意味不明に    | Topic-coherence 自動検証、CS部門レビュー |
| wが曖昧すぎる         | Δμ/ΔHが過信される | ベイズ推定＋感度分析＋スライダーで可視化          |
| UIが重すぎる         | 実運用に耐えない    | グラフは事前計算しキャッシュ、描画最適化          |

---

## 8. 受け入れ条件（抜粋）

* `make hb` / `make vgae` 実行で `.html` + `.pptx` が出力されること
* UIでwスライダーを動かしても2秒以内にグラフ更新されること
* ValueUp上位5件のPrecision\@5が0.3を超えること
* k-匿名性 ≥ 5、DP Gap ≤ 0.1であること

---

## 9. 初期アクション

1. **アンカー語の最終決定**（CS・マーケで30分ミーティング）
2. **市場シェアCSV提出**（なければw推定モードに切替）
3. **`00_load_clean.ipynb`と`02_weight_bayes.ipynb`の雛形作成**
4. **共通コードベース (`src/`) のGitレポ用意＋Makefile設置**

---

> ✳ ご希望あればこの要件定義書を**PDF/Markdown/スライド形式**に変換いたします。次に取り組みたいフェーズをご指示ください！
